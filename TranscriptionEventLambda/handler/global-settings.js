!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1204)}({11:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e){this.globalRepo=e}getSettings(){return this.globalRepo.getGlobalSettings()}update(e,t,n,r){return this.globalRepo.updateGlobalSettings(e,t,n,r).then(e=>{console.log("Result: "+JSON.stringify(e));let{transcribeVoicemail:t,encryptVoicemail:n,deliveryEmail:r,availableSMSCountries:a}=e.Attributes;return{transcribeVoicemail:t,encryptVoicemail:n,deliveryEmail:r,availableSMSCountries:a}})}createDefault(){return this.globalRepo.createGlobalSettings(!0,!0,process.env.DELIVERY_EMAIL)}}},1204:function(e,t,n){"use strict";n.r(t);var r=n(11),a=n(14),i=n(6);const s=new r.a(new a.a);exports.update=async(e,t)=>{let{transcribeVoicemail:n,encryptVoicemail:r,deliveryEmail:a,availableSMSCountries:o}=JSON.parse(e.body);return console.log("Update Global Settings"),s.update(n,r,a,o).then(e=>i.a.Response(200,{settings:e},!0)).catch(e=>i.a.Error(400,e,"Unable to update global settings",!0))},exports.get=async(e,t)=>(console.log("Update Global Settings"),s.getSettings().then(e=>i.a.Response(200,{settings:e},!0)).catch(e=>i.a.Error(400,e,"Unable to update global settings",!0)))},14:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(4);class a{constructor(e){this.transcribeVoicemail=e.transcribeVoicemail||!1,this.encryptVoicemail=e.encryptVoicemail||!1,this.deliveryEmail=e.deliveryEmail||null,this.availableSMSCountries=e.availableSMSCountries||(process.env.AVAILABLE_SMS_COUNTRIES||"").split(",")}}class i{constructor(){this.dynamo=new r.a(process.env.GLOBAL_TABLE_NAME),this.amazonConnectInstanceArn=process.env.AMAZON_CONNECT_INSTANCE_ARN}getGlobalSettings(){console.log("Getting Global Settings");let e={Key:{instanceArn:this.amazonConnectInstanceArn}};return this.dynamo.getItem(e).then(e=>e?new a(e):null)}createGlobalSettings(e,t,n,r){let i=new a({transcribeVoicemail:e,encryptVoicemail:t,deliveryEmail:n,availableSMSCountries:r});i.instanceArn=this.amazonConnectInstanceArn;let s={Item:i};return console.log("dynamo put"),this.dynamo.put(s).then(()=>i)}updateGlobalSettings(e,t,n,r){return this.getGlobalSettings().then(a=>a?this._updateGlobalSettings(e,t,n,r):(console.log("in create"),this.createGlobalSettings(e,t,n,r)))}_updateGlobalSettings(e,t,n,r){let a={Key:{instanceArn:this.amazonConnectInstanceArn},ExpressionAttributeValues:{":tv":e,":ev":t,":de":n,":ac":r},UpdateExpression:"SET transcribeVoicemail=:tv, encryptVoicemail=:ev, deliveryEmail=:de, availableSMSCountries=:ac"};return this.dynamo.update(a)}}},3:function(e,t){e.exports=require("aws-sdk")},4:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const r=n(3);class a{constructor(e){this.tableName=e,this.client=new r.DynamoDB.DocumentClient}update(e){return e.TableName=this.tableName,e.ReturnValues="ALL_NEW",this.client.update(e).promise()}put(e){return e.TableName=this.tableName,this.client.put(e).promise()}query(e){return e.TableName=this.tableName,this.client.query(e).promise().then(e=>e.Items||null)}scan(e,t=[]){return e.TableName=this.tableName,this.client.scan(e).promise().then(n=>{let r=t;return n.Items&&(r=t.concat(n.Items)),n.LastEvaluatedKey?(console.log("Rescanning with next page"),e.ExclusiveStartKey=n.LastEvaluatedKey,this.scan(e,r)):r})}queryWithNext(e){return e.TableName=this.tableName,this.client.query(e).promise().then(e=>{let t={data:e.Items||[]};return e.LastEvaluatedKey&&(t.next=Buffer.from(JSON.stringify(e.LastEvaluatedKey),"utf8").toString("base64")),t})}scanWithNext(e){return e.TableName=this.tableName,this.client.scan(e).promise().then(e=>{let t={data:e.Items||[]};return e.LastEvaluatedKey&&(t.next=Buffer.from(JSON.stringify(e.LastEvaluatedKey),"utf8").toString("base64")),t})}getItem(e,t){return e.TableName=this.tableName,this.client.get(e).promise().then(e=>e.Item||null)}batchWrite(e,t){return new Promise((n,r)=>{this._batchWrite(e,t).then(t=>{e.length>t.index?this.batchWrite(e,t.index).then(e=>{n(e)}):n(t.data)})})}_batchWrite(e,t){return new Promise((n,r)=>{let a=e.length>t+24?t+24:e.length,i=e.slice(t,a),s={RequestItems:{[this.tableName]:i}};this.client.batchWrite(s,(e,r)=>{e&&console.log("Any error? "+JSON.stringify(e,null,2)),n({index:t+24,data:r})})})}}},6:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const r={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":!0,"Strict-Transport-Security":"max-age=31536000; includeSubDomains","X-Frame-Options":"DENY"};const a={Response:function(e,t={},n=!1,a=null){let i={statusCode:e,body:JSON.stringify(t)};if(n&&(i.headers=r),a){let e=i.headers;e={...e,...a},i.headers=e}return i},Error:function e(t,n,a,i=!1){console.log(n,n instanceof e,n.toString());let s="",o="Error",l="",c="";n.hasOwnProperty("message")&&(s=n.message),n.hasOwnProperty("name")&&(o=n.name),n.hasOwnProperty("stack")&&(l=n.stack),n.hasOwnProperty("developerMessage")&&(c=n.developerMessage);let u={statusCode:t,body:JSON.stringify({errorMessage:a})};return i&&(u.headers=r),console.log("Error:",u),u}}}}));
//# sourceMappingURL=global-settings.js.map