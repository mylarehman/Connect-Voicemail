!function(e,t){for(var o in t)e[o]=t[o]}(exports,function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=71)}({15:function(e,t){e.exports=require("url")},3:function(e,t){e.exports=require("aws-sdk")},71:function(e,t,o){"use strict";console.log("Loading function");const n=o(8),r=o(15);let s=o(3),u=new s.S3,c=new s.CognitoIdentityServiceProvider;const i=o(72);t.handler=(e,t,o)=>{let n="FAILED",r={};"Create"===e.RequestType?"customizeUserPool"===e.ResourceProperties.customAction?g(e.ResourceProperties,(function(s,u){s?(r={Error:"Customize user pool function failed"},console.log([r.Error,":\n",s].join(""))):(n="SUCCESS",r={}),l(e,o,t.logStreamName,n,r)})):"cleanUpS3Bucket"===e.ResourceProperties.customAction&&(n="SUCCESS",r={},l(e,o,t.logStreamName,n,r)):"Delete"===e.RequestType?("cleanUpS3Bucket"===e.ResourceProperties.customAction&&a(e.ResourceProperties,(function(s,u){s?(r={Error:"Clean up S3 bucket function failed"},console.log([r.Error,":\n",s].join(""))):(n="SUCCESS",r={}),l(e,o,t.logStreamName,n,r)})),n="SUCCESS",l(e,o,t.logStreamName,n,r)):"customizeUserPool"===e.ResourceProperties.customAction&&(n="SUCCESS",r={},l(e,o,t.logStreamName,n,r))};let l=function(e,t,o,s,u){const c=JSON.stringify({Status:s,Reason:"See the details in CloudWatch Log Stream: "+o,PhysicalResourceId:o,StackId:e.StackId,RequestId:e.RequestId,LogicalResourceId:e.LogicalResourceId,Data:u}),i=r.parse(e.ResponseURL),l={hostname:i.hostname,port:443,path:i.path,method:"PUT",headers:{"Content-Type":"","Content-Length":c.length}},a=n.request(l,e=>{t(null,"Successfully sent stack response!")});a.on("error",e=>{console.log("sendResponse Error:\n",e),t(e)}),a.write(c),a.end()},a=function(e,t){var o={Bucket:e.DestBucket};u.getBucketVersioning(o,(function(o,n){return o?(console.log("Error getting the bucket version: "+o),t(o,null)):(n.Status?(console.log("This is a versioned Bucket"),f(e.DestBucket,t)):(console.log("This is not a versioned bucket"),d(e.DestBucket,t)),t(null,"success"))}))},f=function(e,t){var o={Bucket:e};u.listObjectVersions(o,(function(o,n){if(o)console.log("error listing bucket objects "+o);else{for(var r=[],s=n.Versions,c=0;c<s.length;c+=1)r.push({Key:s[c].Key,VersionId:s[c].VersionId});var i=n.DeleteMarkers;for(c=0;c<i.length;c+=1)r.push({Key:i[c].Key,VersionId:i[c].VersionId});var l={Bucket:e,Delete:{Objects:r}};u.deleteObjects(l,(function(e,o){if(e)return console.log("error deleting objects "+e),t(e,null);t(null,"success")}))}}))},d=function(e,t){var o={Bucket:e};u.listObjects(o,(function(e,o){if(e)console.log("error listing bucket objects "+e);else{for(var n=o.Contents,r=[],s=0;s<n.length;s+=1)r.push({Key:n[s].Key});var c={Bucket:bucket,Objects:r};u.deleteObjects(c,(function(e,o){if(e)return console.log("error deleting objects "+e),t(e,null);t(null,"success")}))}}))},g=function(e,t){c.setUICustomization({UserPoolId:e.UserPoolId,ClientId:e.ClientId,CSS:e.CSS,ImageFile:new Buffer.from(i.encode(e.ImageFile),"base64")},(function(e,o){if(e)return console.log("Error setting the UI customization "+e),t(e,null);t(null,o)}))}},72:function(e,t){e.exports=require("utf8")},8:function(e,t){e.exports=require("https")}}));
//# sourceMappingURL=cloudfront-helper.js.map