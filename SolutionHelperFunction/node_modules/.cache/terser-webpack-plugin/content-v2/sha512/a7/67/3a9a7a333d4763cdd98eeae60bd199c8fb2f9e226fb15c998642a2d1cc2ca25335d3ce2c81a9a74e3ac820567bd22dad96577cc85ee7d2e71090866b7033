{"map":"{\"version\":3,\"sources\":[\"solution-helper.js\"],\"names\":[\"e\",\"a\",\"i\",\"exports\",\"modules\",\"installedModules\",\"__webpack_require__\",\"moduleId\",\"module\",\"l\",\"call\",\"m\",\"c\",\"d\",\"name\",\"getter\",\"o\",\"Object\",\"defineProperty\",\"enumerable\",\"get\",\"r\",\"Symbol\",\"toStringTag\",\"value\",\"t\",\"mode\",\"__esModule\",\"ns\",\"create\",\"key\",\"bind\",\"n\",\"object\",\"property\",\"prototype\",\"hasOwnProperty\",\"p\",\"s\",\"1205\",\"console\",\"log\",\"https\",\"url\",\"UUID\",\"AWS\",\"s3\",\"S3\",\"fs\",\"agw\",\"APIGateway\",\"handler\",\"event\",\"context\",\"callback\",\"responseStatus\",\"responseData\",\"RequestType\",\"ResourceProperties\",\"customAction\",\"v4\",\"sendResponse\",\"logStreamName\",\"copyWebAssets\",\"err\",\"data\",\"Error\",\"join\",\"responseBody\",\"JSON\",\"stringify\",\"Status\",\"Reason\",\"PhysicalResourceId\",\"StackId\",\"RequestId\",\"LogicalResourceId\",\"Data\",\"parsedUrl\",\"parse\",\"ResponseURL\",\"options\",\"hostname\",\"port\",\"path\",\"method\",\"headers\",\"Content-Type\",\"Content-Length\",\"length\",\"req\",\"request\",\"res\",\"on\",\"write\",\"end\",\"properties\",\"sourceS3Bucket\",\"SourceBucket\",\"sourceS3KeyPrefix\",\"SourcePrefixKey\",\"destS3Bucket\",\"DestBucket\",\"baseApi\",\"BaseApi\",\"apiKey\",\"ApiGatewayKey\",\"cognitoDomain\",\"CognitoDomain\",\"clientId\",\"ClientId\",\"userPoolId\",\"UserPoolId\",\"redirDomain\",\"RedirDomain\",\"downloadWebisteManifest\",\"readFile\",\"_manifest\",\"validateJSON\",\"getApiKey\",\"includeValue\",\"gwKey\",\"fileList\",\"getManifestFiles\",\"files\",\"uploadFile\",\"result\",\"s3Bucket\",\"s3Key\",\"params\",\"Bucket\",\"Key\",\"headObject\",\"metadata\",\"code\",\"file\",\"createWriteStream\",\"getObject\",\"chunk\",\"send\",\"body\",\"filelist\",\"index\",\"sourceS3prefix\",\"cb\",\"startsWith\",\"endsWith\",\"getObjectParams\",\"Body\",\"toString\",\"replace\",\"putObjectParams\",\"ContentType\",\"putObject\",\"resp\",\"CopySource\",\"MetadataDirective\",\"copyObject\",\"fileListObject\",\"push\",\"substring\",\"15\",\"require\",\"16\",\"19\",\"3\",\"8\"],\"mappings\":\"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\"}","code":"!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=1205)}({1205:function(e,t,n){\"use strict\";console.log(\"Loading function\");const o=n(8),r=n(15),s=n(19);let i=n(3),l=new i.S3;const u=n(16);let c=new i.APIGateway;t.handler=(e,t,n)=>{let o=\"FAILED\",r={};console.log(\"Request type: \"+e.RequestType),\"Create\"===e.RequestType?\"createUuid\"===e.ResourceProperties.customAction?(o=\"SUCCESS\",r={UUID:s.v4()},a(e,n,t.logStreamName,o,r)):\"copyWebAssets\"===e.ResourceProperties.customAction&&f(e.ResourceProperties,(function(s,i){s?(r={Error:\"Copy of website assets failed\"},console.log([r.Error,\":\\n\",s].join(\"\"))):(o=\"SUCCESS\",r={}),a(e,n,t.logStreamName,o,r)})):\"Delete\"===e.RequestType?(o=\"SUCCESS\",a(e,n,t.logStreamName,o,r)):\"copyWebAssets\"===e.ResourceProperties.customAction&&f(e.ResourceProperties,(function(s,i){s?(r={Error:\"Copy of website assets failed\"},console.log([r.Error,\":\\n\",s].join(\"\"))):(o=\"SUCCESS\",r={}),a(e,n,t.logStreamName,o,r)}))};let a=function(e,t,n,s,i){const l=JSON.stringify({Status:s,Reason:\"See the details in CloudWatch Log Stream: \"+n,PhysicalResourceId:n,StackId:e.StackId,RequestId:e.RequestId,LogicalResourceId:e.LogicalResourceId,Data:i}),u=r.parse(e.ResponseURL),c={hostname:u.hostname,port:443,path:u.path,method:\"PUT\",headers:{\"Content-Type\":\"\",\"Content-Length\":l.length}},a=o.request(c,e=>{t(null,\"Successfully sent stack response!\")});a.on(\"error\",e=>{console.log(\"sendResponse Error:\\n\",e),t(e)}),a.write(l),a.end()},f=function(e,t){let n=e.SourceBucket,o=e.SourcePrefixKey,r=e.DestBucket,s=e.BaseApi,i=e.ApiGatewayKey,l=e.CognitoDomain,a=e.ClientId,f=e.UserPoolId,m=e.RedirDomain;p(n,o+\"asset-manifest.json\",(function(e,p){if(e)return console.log(e),t(e,null);u.readFile(\"/tmp/web-site-manifest.json\",\"utf8\",(function(e,u){if(e)return console.log(e),t(e,null);let p=d(u);if(!p)return t(\"Unable to validate downloaded manifest file JSON\",null);c.getApiKey({apiKey:i,includeValue:!0},(function(e,i){let u=y(p.files);g(u,0,r,n,o,s,i,l,a,f,m,(function(e,n){return e?t(e,null):t(null,\"success\")}))}))}))}))},p=function(e,t,o){let r={Bucket:e,Key:t};l.headObject(r,(function(e,t){if(e&&console.log(e),e&&\"NotFound\"===e.code)return o(\"Manifest file was not found.\",null);{let e=n(16).createWriteStream(\"/tmp/web-site-manifest.json\");l.getObject(r).on(\"httpData\",(function(t){e.write(t)})).on(\"httpDone\",(function(){return e.end(),console.log(\"website manifest downloaded for processing...\"),o(null,\"success\")})).send()}}))},d=function(e){try{return JSON.parse(e)}catch(e){return console.log(\"Manifest file contains invalid JSON.\"),null}},g=function(e,t,n,o,r,s,i,u,c,a,f,p){if(e.length>t)if(e[t].startsWith(\"static\")&&(e[t].endsWith(\"js\")||e[t].endsWith(\"map\"))){let d={Bucket:o,Key:r+e[t]};l.getObject(d,(function(d,y){let m=y.Body.toString(\"utf-8\");m=m.replace(/__BASE_API__/g,s).replace(/__API_KEY__/g,i.value).replace(/__C_DOMAIN__/g,u).replace(/__C_POOL__/g,a).replace(/__C_CLIENT_ID__/g,c).replace(/__C_REDIR__/g,f);let _={Body:m,Bucket:n,Key:e[t],ContentType:\"application/javascript\"};l.putObject(_,(function(e,t){e&&console.log(\"Error putting: \"+e)})),g(e,t+1,n,o,r,s,i,u,c,a,f,(function(e,t){if(e)return p(e,null);p(null,t)}))}))}else{let d={Bucket:n,Key:e[t],CopySource:o+\"/\"+r+e[t],MetadataDirective:\"REPLACE\"};e[t].endsWith(\".htm\")||e[t].endsWith(\".html\")?d.ContentType=\"text/html\":e[t].endsWith(\".css\")?d.ContentType=\"text/css\":e[t].endsWith(\".js\")?d.ContentType=\"application/javascript\":e[t].endsWith(\".png\")&&(d.ContentType=\"image/png\"),l.copyObject(d,(function(l,d){if(l)console.log([\"error copying \",[r,e[t]].join(\"\"),\"\\n\",l].join(\"\"));else{console.log([[r,e[t]].join(\"/\"),\"uploaded successfully\"].join(\" \")),g(e,t+1,n,o,r,s,i,u,c,a,f,(function(e,t){if(e)return p(e,null);p(null,t)}))}}))}else p(null,[t,\"files copied\"].join(\" \"))},y=function(e){let t=[\"asset-manifest.json\",\"manifest.json\",\"favicon.ico\",\"robots.txt\",\"images/ContactFlowIcon.png\",\"images/ContactFlowIcon_2x.png\",\"images/ContactFlowIcon_3x.png\",\"images/logo80.png\",\"images/logo80_2x.png\"];for(var n in e)t.push(e[n].substring(1));return t}},15:function(e,t){e.exports=require(\"url\")},16:function(e,t){e.exports=require(\"fs\")},19:function(e,t){e.exports=require(\"uuid\")},3:function(e,t){e.exports=require(\"aws-sdk\")},8:function(e,t){e.exports=require(\"https\")}}));","extractedComments":[]}