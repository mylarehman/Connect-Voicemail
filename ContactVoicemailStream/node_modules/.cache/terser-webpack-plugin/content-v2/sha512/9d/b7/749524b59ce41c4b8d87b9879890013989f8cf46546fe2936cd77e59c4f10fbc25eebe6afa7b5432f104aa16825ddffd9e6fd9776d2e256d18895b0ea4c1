{"map":"{\"version\":3,\"sources\":[\"sync-vm-connect.js\"],\"names\":[\"e\",\"a\",\"i\",\"exports\",\"modules\",\"installedModules\",\"__webpack_require__\",\"moduleId\",\"module\",\"l\",\"call\",\"m\",\"c\",\"d\",\"name\",\"getter\",\"o\",\"Object\",\"defineProperty\",\"enumerable\",\"get\",\"r\",\"Symbol\",\"toStringTag\",\"value\",\"t\",\"mode\",\"__esModule\",\"ns\",\"create\",\"key\",\"bind\",\"n\",\"object\",\"property\",\"prototype\",\"hasOwnProperty\",\"p\",\"s\",\"10\",\"__webpack_exports__\",\"UsersRepo\",\"_lib_dynamo__WEBPACK_IMPORTED_MODULE_0__\",\"_domain_agent_domain__WEBPACK_IMPORTED_MODULE_1__\",\"[object Object]\",\"this\",\"dynamo\",\"process\",\"env\",\"USERS_TABLE_NAME\",\"amazonConnectInstanceId\",\"AMAZON_CONNECT_INSTANCE_ARN\",\"extension\",\"params\",\"IndexName\",\"KeyConditionExpression\",\"ExpressionAttributeValues\",\":ext\",\"query\",\"then\",\"items\",\"length\",\"userId\",\"Key\",\"agentId\",\"getItem\",\"item\",\"next\",\"size\",\"param\",\"Limit\",\"Select\",\"ExclusiveStartKey\",\"JSON\",\"parse\",\"Buffer\",\"from\",\"toString\",\"scanWithNext\",\"scan\",\"agent\",\"data\",\"Item\",\"createAgentData\",\"put\",\"deliverSMSPhoneNumber\",\"deliverSMS\",\"deliverEmail\",\"encryptVoicemail\",\"transcribeVoicemail\",\"expressionAttrValues\",\":tv\",\":ev\",\":de\",\":do\",\"email\",\"sms\",\"enabled\",\"phoneNumber\",\"updateExpression\",\"UpdateExpression\",\"update\",\"values\",\"batchWrite\",\"12\",\"connect_agent_service_ConnectAgentService\",\"ConnectAgent\",\"connectUser\",\"standard_errors\",\"agent_domain\",\"agent_errors_ExtensionInUseError\",\"super\",\"external_awesome_phonenumber_\",\"external_awesome_phonenumber_default\",\"connectService\",\"usersRepo\",\"getAgentByExtension\",\"getConnectUser\",\"user\",\"getAgentByUserId\",\"getAgents\",\"Promise\",\"all\",\"listConnectUsers\",\"getAllAgents\",\"connectUsers\",\"dbUsers\",\"needUpdate\",\"forEach\",\"found\",\"find\",\"dbUser\",\"Id\",\"username\",\"Username\",\"push\",\"PutRequest\",\"createAgentCreateParam\",\"DeleteRequest\",\"createAgentDeleteParam\",\"_validateAgentUpdate\",\"createAgentIfNeeded\",\"updateAgentById\",\"getConnectAgentByUserId\",\"createAgentPromise\",\"createAgent\",\"resolve\",\"reject\",\"undefined\",\"phone\",\"isValid\",\"getNumber\",\"Number\",\"isNaN\",\"1206\",\"_service_connect_agent_service__WEBPACK_IMPORTED_MODULE_1__\",\"_service_connect_service__WEBPACK_IMPORTED_MODULE_2__\",\"_repo_users_repo__WEBPACK_IMPORTED_MODULE_3__\",\"_lib_responder__WEBPACK_IMPORTED_MODULE_4__\",\"_lib_metrics__WEBPACK_IMPORTED_MODULE_5__\",\"agentService\",\"sendMetrics\",\"status\",\"details\",\"SEND_ANON_DATA\",\"sendAnonymousData\",\"uuid\",\"UUID\",\"catch\",\"console\",\"log\",\"message\",\"syncHandler\",\"event\",\"context\",\"syncConnectAgents\",\"err\",\"Error\",\"syncRequestHandler\",\"Response\",\"stringify\",\"13\",\"connect_service_ConnectService\",\"ConnectUser\",\"userMap\",\"detail\",\"arn\",\"firstName\",\"lastName\",\"phoneType\",\"autoAccept\",\"deskPhoneNumber\",\"directoryUserId\",\"routingProfileId\",\"AWS\",\"instanceId\",\"split\",\"connect\",\"Connect\",\"maxBackOffTime\",\"users\",\"promises\",\"map\",\"InstanceId\",\"UserId\",\"describeUser\",\"User\",\"_listConnectUsers\",\"list\",\"nextToken\",\"retry\",\"MaxResults\",\"listUsers\",\"promise\",\"UserSummaryList\",\"NextToken\",\"concat\",\"warn\",\"Math\",\"min\",\"pow\",\"setTimeout\",\"2\",\"GenericError\",\"MissingParameterError\",\"InvalidParameterError\",\"MissingParametersError\",\"developerMessage\",\"parameter\",\"20\",\"HTTPS\",\"Metrics\",\"Constants\",\"Host\",\"Path\",\"payload\",\"assign\",\"Solution\",\"SOLUTION_ID\",\"TimeStamp\",\"Date\",\"toISOString\",\"replace\",\"Data\",\"buffers\",\"hostname\",\"port\",\"path\",\"method\",\"headers\",\"Content-Type\",\"request\",\"response\",\"on\",\"chunk\",\"statusCode\",\"statusMessage\",\"write\",\"end\",\"3\",\"require\",\"32\",\"4\",\"DynamoDBService\",\"tableName\",\"client\",\"DynamoDB\",\"DocumentClient\",\"result\",\"Items\",\"allItems\",\"LastEvaluatedKey\",\"callback\",\"batch\",\"startingIndex\",\"_batchWrite\",\"index\",\"nextData\",\"endIndex\",\"batchToUpdate\",\"slice\",\"batchParam\",\"RequestItems\",\"5\",\"Agent\",\"agentMap\",\"deliveryOptions\",\"6\",\"Responder\",\"ALLOW_ORIGIN_HEADER\",\"Access-Control-Allow-Origin\",\"Access-Control-Allow-Credentials\",\"Strict-Transport-Security\",\"X-Frame-Options\",\"body\",\"cors\",\"customHeaders\",\"error\",\"description\",\"errorMessage\",\"errorName\",\"errorStack\",\"stack\",\"8\",\"9\"],\"mappings\":\"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\"}","code":"!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=1206)}({10:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return i}));var s=n(4),r=n(5);class i{constructor(){this.dynamo=new s.a(process.env.USERS_TABLE_NAME),this.amazonConnectInstanceId=process.env.AMAZON_CONNECT_INSTANCE_ARN}getAgentByExtension(e){let t={IndexName:\"AgentExtensionIndex\",KeyConditionExpression:\"extension = :ext\",ExpressionAttributeValues:{\":ext\":e}};return this.dynamo.query(t).then(e=>e.length>0?new r.a(e[0]):null)}getAgentByUserId(e){let t={Key:{agentId:e}};return this.dynamo.getItem(t).then(e=>e?new r.a(e):null)}getAgents(e,t){let n={Limit:t||1e3,Select:\"ALL_ATTRIBUTES\"};return e&&(n.ExclusiveStartKey=JSON.parse(Buffer.from(e,\"base64\").toString(\"utf-8\"))),this.dynamo.scanWithNext(n)}getAllAgents(){return this.dynamo.scan({Select:\"ALL_ATTRIBUTES\"})}createAgentCreateParam(e){let t={Item:{...e,agentId:e.userId}};return\"\"===e.extension&&delete t.Item.extension,t}createAgentDeleteParam(e){return{Key:{agentId:e.userId}}}createAgent(e){let t=this.createAgentData(e);return this.dynamo.put(t)}updateAgentById(e,{extension:t,deliverSMSPhoneNumber:n,deliverSMS:s,deliverEmail:r,encryptVoicemail:i,transcribeVoicemail:o}){let a={\":tv\":o||!1,\":ev\":i||!1,\":de\":r,\":do\":{email:r,sms:{enabled:s,phoneNumber:\"\"===n?\"null\":n}}};null!==t&&\"\"!==t&&(a[\":ext\"]=t);let u=\"SET transcribeVoicemail=:tv, encryptVoicemail = :ev, deliveryEmail = :de, deliveryOptions = :do\";u+=null===t||\"\"===t?\" REMOVE extension\":\", extension = :ext\";let c={Key:{agentId:e},ExpressionAttributeValues:a,UpdateExpression:u};return this.dynamo.update(c)}batchWrite(e){return this.dynamo.batchWrite(e,0)}}},12:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return c}));class s{constructor(e,t){this.userId=e.userId,this.agent=e,this.connectUser=t}}var r=n(2),i=n(5);r.a;class o extends r.a{constructor(e){super(\"ExtensionInUseError\",\"Extension already in use. Please provide a different extension number.\",\"Cannot have more than one user assigned to the extension number: \"+e)}}var a=n(9),u=n.n(a);class c{constructor(e,t){this.usersRepo=t,this.connectService=e}getConnectAgentByExtension(e){return this.usersRepo.getAgentByExtension(e).then(e=>this.connectService.getConnectUser(e.userId).then(t=>new s(e,t)))}getConnectAgentByUserId(e){return this.connectService.getConnectUser(e).then(t=>this.usersRepo.getAgentByUserId(e).then(e=>new s(e,t)))}getConnectAgents(e,t){return this.usersRepo.getAgents(e,t)}syncConnectAgents(){return Promise.all([this.connectService.listConnectUsers(),this.usersRepo.getAllAgents()]).then(e=>{let[t,n]=e,s=[];if(t.forEach(e=>{const t=n.find(t=>t.userId===e.Id);let r;t&&t.username!==e.Username?(r={...t,username:e.Username},s.push({PutRequest:this.usersRepo.createAgentCreateParam(r)})):t||(r={userId:e.Id,username:e.Username},s.push({PutRequest:this.usersRepo.createAgentCreateParam(r)}))}),n.forEach(e=>{t.find(t=>t.Id===e.userId)||s.push({DeleteRequest:this.usersRepo.createAgentDeleteParam(e)})}),s.length>0)return this.usersRepo.batchWrite(s)})}updateAgentById(e,t){return this._validateAgentUpdate(e,t).then(()=>this.createAgentIfNeeded(e,t.extension)).then(()=>this.usersRepo.updateAgentById(e,t)).then(()=>this.getConnectAgentByUserId(e))}createAgentIfNeeded(e,t){let n=this.usersRepo.getAgentByUserId(e).then(n=>null===n?this.usersRepo.createAgent(i.a.create(e,t)):n);return t?this.usersRepo.getAgentByExtension(t).then(n=>{if(null!=n&&n.userId!==e)throw new o(t);return n}).then(()=>n):n}_validateAgentUpdate(e,t){return new Promise((n,s)=>{let{extension:i,deliverSMSPhoneNumber:o,deliverSMS:a,deliverEmail:c,encryptVoicemail:l,transcribeVoicemail:d}=t;if(e)if(!0!==a||void 0!==o&&\"\"!==o){if(o){let e=new u.a(o);e.isValid()?t.deliverSMSPhoneNumber=e.getNumber():s(new r.a(\"InvalidPhoneNumberError\",\"The phone number you've entered is invalid.  Please enter a valid phone number and try again.\",\"Phone number cannot be validated for \"+o))}t.hasOwnProperty(\"extension\")&&(t.extension.length>5||Number.isNaN(t.extension))?s(new r.b(\"Invalid extension number\",\"Extension number must be numeric and less than 5 digits.\")):t.hasOwnProperty(\"extension\")&&t.hasOwnProperty(\"deliverSMS\")&&t.hasOwnProperty(\"deliverEmail\")&&t.hasOwnProperty(\"transcribeVoicemail\")&&t.hasOwnProperty(\"encryptVoicemail\")?n({agentId:e,update:t}):s(new r.d)}else s(new r.b(\"Please provide a phone number for SMS delivery\",\"deliverSMSPhoneNumber cannot be null or empty if deliverSMS is true\"));else s(new r.c(\"agentId\"))})}}},1206:function(e,t,n){\"use strict\";n.r(t);n(32);var s=n(12),r=n(13),i=n(10),o=n(6),a=n(20);const u=new s.a(new r.a,new i.a);function c(e,t){\"true\"==process.env.SEND_ANON_DATA&&a.Metrics.sendAnonymousData({uuid:process.env.UUID,process:\"sync\",status:e,details:t||\"\"}).catch(e=>console.log(\"sendAnonymous: \"+e.message))}exports.syncHandler=(e,t)=>u.syncConnectAgents().then(e=>{c(\"Success\")}).catch(e=>{c(\"Failure\",o.a.Error(400,e,\"Unable to sync agents\",!0))}),exports.syncRequestHandler=(e,t)=>u.syncConnectAgents().then(e=>(c(\"Success\"),o.a.Response(200,{},!0))).catch(e=>{console.log(\"returning a 400: \"+JSON.stringify(e));let t=o.a.Error(400,e,\"Unable to sync agents\",!0);return c(\"Failure\",t),t})},13:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return i}));class s{constructor(e,t=!0){this.userId=e.Id,this.arn=e.Arn,this.username=e.Username,t&&(this.firstName=e.IdentityInfo.FirstName,this.lastName=e.IdentityInfo.LastName,this.email=e.IdentityInfo.Email,e.hasOwnProperty(\"PhoneConfig\")?(this.phoneType=e.PhoneConfig.PhoneType,this.autoAccept=e.PhoneConfig.AutoAccept,this.deskPhoneNumber=e.PhoneConfig.DeskPhoneNumber):(this.phoneType=null,this.autoAccept=null,this.deskPhoneNumber=null),this.directoryUserId=e.DirectoryUserId,this.routingProfileId=e.RoutingProfileId)}getFullName(){return`${this.firstName} ${this.lastName}`}}const r=n(3);class i{constructor(){this.instanceId=process.env.AMAZON_CONNECT_INSTANCE_ARN.split(\"/\")[1],this.connect=new r.Connect,this.maxBackOffTime=45}getConnectUsers(){return this.listConnectUsers().then(e=>{let t=e.map(e=>this.getConnectUser(e.Id));return Promise.all(t)})}getConnectUser(e){return new Promise((t,n)=>{let r={InstanceId:this.instanceId,UserId:e};this.connect.describeUser(r,(e,r)=>e?(console.log(\"Error\",e),void n(e)):r?void t(new s(r.User)):(console.log(\"No user found\"),void n(e)))})}listConnectUsers(){return this._listConnectUsers([],null,0)}_listConnectUsers(e,t,n){let s={InstanceId:this.instanceId,MaxResults:1e3};return t&&(s.NextToken=t),this.connect.listUsers(s).promise().then(t=>{let{UserSummaryList:n,NextToken:s}=t,r=e.concat(n);return s?this._listConnectUsers(r,s,0):r}).catch(s=>{if(console.warn(\"list connect user failed. Retry: \"+n,s),n>5)throw s;return(r=Math.min(Math.pow(n,2),this.maxBackOffTime),new Promise(e=>setTimeout(e,r))).then(()=>this._listConnectUsers(e,t,n+1));var r})}}},2:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return s})),n.d(t,\"c\",(function(){return r})),n.d(t,\"b\",(function(){return i})),n.d(t,\"d\",(function(){return o}));class s extends Error{constructor(e,t,n){super(),this.message=t,this.developerMessage=n,this.name=e}}class r extends s{constructor(e){super(\"MissingParameterError\",\"Missing parameter\",\"Missing parameter: \"+e)}}class i extends s{constructor(e,t){super(\"InvalidParameterValueError\",e,t)}}class o extends s{constructor(){super(\"MissingParametersError\",\"One or more parameters are missing\",\"You have one ore more parameters miss, please see documentation for more information.\")}}},20:function(e,t,n){const s=n(8);class r{static get Constants(){return{Host:\"metrics.awssolutionsbuilder.com\",Path:\"/generic\"}}static async sendAnonymousData(e,t){return new Promise((n,i)=>{const o=Object.assign({Solution:process.env.SOLUTION_ID,UUID:process.env.UUID,TimeStamp:(new Date).toISOString().replace(\"T\",\" \").replace(\"Z\",\"\"),Data:e},t);o.Data&&o.Solution&&o.UUID||n(void 0);const a=[],u={hostname:r.Constants.Host,port:443,path:r.Constants.Path,method:\"POST\",headers:{\"Content-Type\":\"application/json\"}},c=s.request(u,e=>{e.on(\"data\",e=>a.push(e)),e.on(\"end\",()=>{e.statusCode>=400?i(new Error(`${e.statusCode} ${e.statusMessage} ${u.hostname}`)):n(Buffer.concat(a))})});c.write(JSON.stringify(o)),c.on(\"error\",e=>i(e)),c.end(),console.log(\"successfully sent metrics\")})}}e.exports={Metrics:r}},3:function(e,t){e.exports=require(\"aws-sdk\")},32:function(e,t){e.exports=require(\"source-map-support/register\")},4:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return r}));const s=n(3);class r{constructor(e){this.tableName=e,this.client=new s.DynamoDB.DocumentClient}update(e){return e.TableName=this.tableName,e.ReturnValues=\"ALL_NEW\",this.client.update(e).promise()}put(e){return e.TableName=this.tableName,this.client.put(e).promise()}query(e){return e.TableName=this.tableName,this.client.query(e).promise().then(e=>e.Items||null)}scan(e,t=[]){return e.TableName=this.tableName,this.client.scan(e).promise().then(n=>{let s=t;return n.Items&&(s=t.concat(n.Items)),n.LastEvaluatedKey?(console.log(\"Rescanning with next page\"),e.ExclusiveStartKey=n.LastEvaluatedKey,this.scan(e,s)):s})}queryWithNext(e){return e.TableName=this.tableName,this.client.query(e).promise().then(e=>{let t={data:e.Items||[]};return e.LastEvaluatedKey&&(t.next=Buffer.from(JSON.stringify(e.LastEvaluatedKey),\"utf8\").toString(\"base64\")),t})}scanWithNext(e){return e.TableName=this.tableName,this.client.scan(e).promise().then(e=>{let t={data:e.Items||[]};return e.LastEvaluatedKey&&(t.next=Buffer.from(JSON.stringify(e.LastEvaluatedKey),\"utf8\").toString(\"base64\")),t})}getItem(e,t){return e.TableName=this.tableName,this.client.get(e).promise().then(e=>e.Item||null)}batchWrite(e,t){return new Promise((n,s)=>{this._batchWrite(e,t).then(t=>{e.length>t.index?this.batchWrite(e,t.index).then(e=>{n(e)}):n(t.data)})})}_batchWrite(e,t){return new Promise((n,s)=>{let r=e.length>t+24?t+24:e.length,i=e.slice(t,r),o={RequestItems:{[this.tableName]:i}};this.client.batchWrite(o,(e,s)=>{e&&console.log(\"Any error? \"+JSON.stringify(e,null,2)),n({index:t+24,data:s})})})}}},5:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return s}));class s{constructor(e){this.userId=e.userId,this.extension=e.extension,this.username=e.username,this.transcribeVoicemail=e.transcribeVoicemail||!1,this.encryptVoicemail=e.encryptVoicemail||!1,this.deliveryOptions=e.deliveryOptions||{sms:{enabled:!1,phoneNumber:null},email:!1}}static create(e,t=null){return new s({userId:e,extension:t,deliveryOptions:{sms:{enabled:!1,phoneNumber:null},email:!1}})}}},6:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return r}));const s={\"Access-Control-Allow-Origin\":\"*\",\"Access-Control-Allow-Credentials\":!0,\"Strict-Transport-Security\":\"max-age=31536000; includeSubDomains\",\"X-Frame-Options\":\"DENY\"};const r={Response:function(e,t={},n=!1,r=null){let i={statusCode:e,body:JSON.stringify(t)};if(n&&(i.headers=s),r){let e=i.headers;e={...e,...r},i.headers=e}return i},Error:function e(t,n,r,i=!1){console.log(n,n instanceof e,n.toString());let o=\"\",a=\"Error\",u=\"\",c=\"\";n.hasOwnProperty(\"message\")&&(o=n.message),n.hasOwnProperty(\"name\")&&(a=n.name),n.hasOwnProperty(\"stack\")&&(u=n.stack),n.hasOwnProperty(\"developerMessage\")&&(c=n.developerMessage);let l={statusCode:t,body:JSON.stringify({errorMessage:r})};return i&&(l.headers=s),console.log(\"Error:\",l),l}}},8:function(e,t){e.exports=require(\"https\")},9:function(e,t){e.exports=require(\"awesome-phonenumber\")}}));","extractedComments":[]}