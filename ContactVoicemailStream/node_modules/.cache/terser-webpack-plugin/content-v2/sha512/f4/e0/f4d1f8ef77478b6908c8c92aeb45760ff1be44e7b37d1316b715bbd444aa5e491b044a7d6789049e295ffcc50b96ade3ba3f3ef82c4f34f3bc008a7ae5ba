{"map":"{\"version\":3,\"sources\":[\"copy-artifacts-helper.js\"],\"names\":[\"e\",\"a\",\"i\",\"exports\",\"modules\",\"installedModules\",\"__webpack_require__\",\"moduleId\",\"module\",\"l\",\"call\",\"m\",\"c\",\"d\",\"name\",\"getter\",\"o\",\"Object\",\"defineProperty\",\"enumerable\",\"get\",\"r\",\"Symbol\",\"toStringTag\",\"value\",\"t\",\"mode\",\"__esModule\",\"ns\",\"create\",\"key\",\"bind\",\"n\",\"object\",\"property\",\"prototype\",\"hasOwnProperty\",\"p\",\"s\",\"1202\",\"console\",\"log\",\"https\",\"url\",\"AWS\",\"s3\",\"S3\",\"APIGateway\",\"handler\",\"event\",\"context\",\"callback\",\"JSON\",\"stringify\",\"responseStatus\",\"responseData\",\"RequestType\",\"ResourceProperties\",\"customAction\",\"copyObjects\",\"SourceBucket\",\"DestBucket\",\"Prefix\",\"Objects\",\"err\",\"data\",\"Error\",\"join\",\"getObjectVersion\",\"JarVersionId\",\"LatestJarObjectVersion\",\"ZipVersionId\",\"LatestZipObjectVersion\",\"sendResponse\",\"logStreamName\",\"cleanUpS3Bucket\",\"deleteVersionedObjects\",\"responseBody\",\"Status\",\"Reason\",\"PhysicalResourceId\",\"StackId\",\"RequestId\",\"LogicalResourceId\",\"Data\",\"parsedUrl\",\"parse\",\"ResponseURL\",\"options\",\"hostname\",\"port\",\"path\",\"method\",\"headers\",\"Content-Type\",\"Content-Length\",\"length\",\"req\",\"request\",\"res\",\"on\",\"write\",\"end\",\"properties\",\"params\",\"Bucket\",\"getBucketVersioning\",\"checkIfVersioned\",\"deleteNonVersionedObjects\",\"destBucket\",\"listObjectVersions\",\"objects\",\"versionItems\",\"Versions\",\"push\",\"Key\",\"VersionId\",\"deleteMarkerItems\",\"DeleteMarkers\",\"deleteParams\",\"Delete\",\"deleteObjects\",\"deleteData\",\"listObjects\",\"items\",\"Contents\",\"bucket\",\"sourceBucket\",\"prefix\",\"objectList\",\"index\",\"destKey\",\"CopySource\",\"copyObject\",\"resp\",\"VersionObject\",\"15\",\"require\",\"16\",\"19\",\"3\",\"8\"],\"mappings\":\"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\"}","code":"!function(e,o){for(var t in o)e[t]=o[t]}(exports,function(e){var o={};function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}return t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:r})},t.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&o&&\"string\"!=typeof e)for(var n in e)t.d(r,n,function(o){return e[o]}.bind(null,n));return r},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,\"a\",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p=\"\",t(t.s=1202)}({1202:function(e,o,t){\"use strict\";console.log(\"Loading function\");const r=t(8),n=t(15);t(19);let s=t(3),c=new s.S3;t(16);new s.APIGateway;o.handler=(e,o,t)=>{console.log(\"Event: \"+JSON.stringify(e));let r=\"FAILED\",n={};\"Create\"===e.RequestType?\"copyObjects\"===e.ResourceProperties.customAction?f(e.ResourceProperties.SourceBucket,e.ResourceProperties.DestBucket,e.ResourceProperties.Prefix,e.ResourceProperties.Objects,0,(function(s,c){s?(n={Error:\"Copy objects function failed\"},console.log([n.Error,\":\\n\",s].join(\"\"))):p(e.ResourceProperties.DestBucket,(function(s,c){s?(n={Error:\"Get S3 Object Version function failed\"},console.log([n.Error,\":\\n\",s].join(\"\"))):(r=\"SUCCESS\",n={JarVersionId:c.LatestJarObjectVersion,ZipVersionId:c.LatestZipObjectVersion}),i(e,t,o.logStreamName,r,n)}))})):\"cleanUpS3Bucket\"===e.ResourceProperties.customAction&&(r=\"SUCCESS\",n={},i(e,t,o.logStreamName,r,n)):\"Delete\"===e.RequestType?(\"cleanUpS3Bucket\"===e.ResourceProperties.customAction&&u(e.ResourceProperties,(function(s,c){s?(n={Error:\"Clean up S3 bucket function failed\"},console.log([n.Error,\":\\n\",s].join(\"\"))):(r=\"SUCCESS\",n={}),i(e,t,o.logStreamName,r,n)})),r=\"SUCCESS\",i(e,t,o.logStreamName,r,n)):\"copyObjects\"===e.ResourceProperties.customAction&&l(e.ResourceProperties.DestBucket,(function(s,c){s?(n={Error:\"Delete objects function failed\"},console.log([n.Error,\":\\n\",s].join(\"\"))):f(e.ResourceProperties.SourceBucket,e.ResourceProperties.DestBucket,e.ResourceProperties.Prefix,e.ResourceProperties.Objects,0,(function(s,c){s?(n={Error:\"Copy objects function failed\"},console.log([n.Error,\":\\n\",s].join(\"\"))):p(e.ResourceProperties.DestBucket,(function(s,c){s?(n={Error:\"Get S3 Object Version function failed\"},console.log([n.Error,\":\\n\",s].join(\"\"))):(r=\"SUCCESS\",n={JarVersionId:c.LatestJarObjectVersion,ZipVersionId:c.LatestZipObjectVersion}),i(e,t,o.logStreamName,r,n)}))}))}))};let i=function(e,o,t,s,c){const i=JSON.stringify({Status:s,Reason:\"See the details in CloudWatch Log Stream: \"+t,PhysicalResourceId:t,StackId:e.StackId,RequestId:e.RequestId,LogicalResourceId:e.LogicalResourceId,Data:c}),u=n.parse(e.ResponseURL),l={hostname:u.hostname,port:443,path:u.path,method:\"PUT\",headers:{\"Content-Type\":\"\",\"Content-Length\":i.length}},a=r.request(l,e=>{o(null,\"Successfully sent stack response!\")});a.on(\"error\",e=>{console.log(\"sendResponse Error:\\n\",e),o(e)}),a.write(i),a.end()},u=function(e,o){var t={Bucket:e.DestBucket};c.getBucketVersioning(t,(function(t,r){return t?(console.log(\"Error getting the bucket version: \"+t),o(t,null)):(r.Status?(console.log(\"This is a versioned Bucket\"),l(e.DestBucket,o)):(console.log(\"This is not a versioned bucket\"),a(e.DestBucket,o)),o(null,\"success\"))}))},l=function(e,o){var t={Bucket:e};c.listObjectVersions(t,(function(t,r){if(t)console.log(\"error listing bucket objects \"+t);else{for(var n=[],s=r.Versions,i=0;i<s.length;i+=1)n.push({Key:s[i].Key,VersionId:s[i].VersionId});var u=r.DeleteMarkers;for(i=0;i<u.length;i+=1)n.push({Key:u[i].Key,VersionId:u[i].VersionId}),console.log(\"deleteMarkerItemKey: \"+u[i].Key+\" deleteMarkerItemId: \"+u[i].VersionId);var l={Bucket:e,Delete:{Objects:n}};c.deleteObjects(l,(function(e,t){if(e)return console.log(\"error deleting objects \"+e),o(e,null);o(null,\"success\")}))}}))},a=function(e,o){var t={Bucket:e};c.listObjects(t,(function(e,t){if(e)console.log(\"error listing bucket objects \"+e);else{for(var r=t.Contents,n=[],s=0;s<r.length;s+=1)n.push({Key:r[s].Key});var i={Bucket:bucket,Objects:n};c.deleteObjects(i,(function(e,t){if(e)return console.log(\"error deleting objects \"+e),o(e,null);o(null,\"success\")}))}}))},f=function(e,o,t,r,n,s){if(r.length>n){let i=\"aws-connect-vm-serverless/\"+r[n],u={CopySource:e+\"/\"+t+r[n],Bucket:o,Key:i};c.copyObject(u,(function(c,i){c&&console.log(\"Error copying file: \"+c),f(e,o,t,r,n+1,(function(e,o){if(e)return console.log(\"Error copying object: \"+r[n+1]+\" \"+e),s(e,null);s(null,o)}))}))}else s(null,[n,\"files copied\"].join(\" \"))},p=function(e,o){var t={Bucket:e};c.listObjectVersions(t,(function(e,t){if(!e){for(var r={},n=t.Versions,s=0;s<n.length;s+=1)\"aws-connect-vm-serverless/aws-connect-vm-java.jar\"===n[s].Key?r.LatestJarObjectVersion=n[s].VersionId:\"aws-connect-vm-serverless/aws-connect-vm.zip\"===n[s].Key&&(r.LatestZipObjectVersion=n[s].VersionId);return o(null,r)}console.log(\"error listing bucket objects \"+e)}))}},15:function(e,o){e.exports=require(\"url\")},16:function(e,o){e.exports=require(\"fs\")},19:function(e,o){e.exports=require(\"uuid\")},3:function(e,o){e.exports=require(\"aws-sdk\")},8:function(e,o){e.exports=require(\"https\")}}));","extractedComments":[]}