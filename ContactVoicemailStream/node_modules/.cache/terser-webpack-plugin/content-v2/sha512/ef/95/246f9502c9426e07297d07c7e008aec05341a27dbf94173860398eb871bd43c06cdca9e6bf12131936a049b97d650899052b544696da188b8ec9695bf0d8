{"map":"{\"version\":3,\"sources\":[\"transcription.js\"],\"names\":[\"e\",\"a\",\"i\",\"exports\",\"modules\",\"installedModules\",\"__webpack_require__\",\"moduleId\",\"module\",\"l\",\"call\",\"m\",\"c\",\"d\",\"name\",\"getter\",\"o\",\"Object\",\"defineProperty\",\"enumerable\",\"get\",\"r\",\"Symbol\",\"toStringTag\",\"value\",\"t\",\"mode\",\"__esModule\",\"ns\",\"create\",\"key\",\"bind\",\"n\",\"object\",\"property\",\"prototype\",\"hasOwnProperty\",\"p\",\"s\",\"10\",\"__webpack_exports__\",\"UsersRepo\",\"_lib_dynamo__WEBPACK_IMPORTED_MODULE_0__\",\"_domain_agent_domain__WEBPACK_IMPORTED_MODULE_1__\",\"[object Object]\",\"this\",\"dynamo\",\"process\",\"env\",\"USERS_TABLE_NAME\",\"amazonConnectInstanceId\",\"AMAZON_CONNECT_INSTANCE_ARN\",\"extension\",\"params\",\"IndexName\",\"KeyConditionExpression\",\"ExpressionAttributeValues\",\":ext\",\"query\",\"then\",\"items\",\"length\",\"userId\",\"Key\",\"agentId\",\"getItem\",\"item\",\"next\",\"size\",\"param\",\"Limit\",\"Select\",\"ExclusiveStartKey\",\"JSON\",\"parse\",\"Buffer\",\"from\",\"toString\",\"scanWithNext\",\"scan\",\"agent\",\"data\",\"Item\",\"createAgentData\",\"put\",\"deliverSMSPhoneNumber\",\"deliverSMS\",\"deliverEmail\",\"encryptVoicemail\",\"transcribeVoicemail\",\"expressionAttrValues\",\":tv\",\":ev\",\":de\",\":do\",\"email\",\"sms\",\"enabled\",\"phoneNumber\",\"updateExpression\",\"UpdateExpression\",\"update\",\"values\",\"batchWrite\",\"11\",\"GlobalSettingsService\",\"globalRepo\",\"getGlobalSettings\",\"transcribe\",\"encrypt\",\"deliveryEmail\",\"availableSMSCountries\",\"updateGlobalSettings\",\"result\",\"console\",\"log\",\"stringify\",\"Attributes\",\"createGlobalSettings\",\"DELIVERY_EMAIL\",\"12\",\"connect_agent_service_ConnectAgentService\",\"ConnectAgent\",\"connectUser\",\"standard_errors\",\"agent_domain\",\"agent_errors_ExtensionInUseError\",\"super\",\"external_awesome_phonenumber_\",\"external_awesome_phonenumber_default\",\"connectService\",\"usersRepo\",\"getAgentByExtension\",\"getConnectUser\",\"user\",\"getAgentByUserId\",\"getAgents\",\"Promise\",\"all\",\"listConnectUsers\",\"getAllAgents\",\"connectUsers\",\"dbUsers\",\"needUpdate\",\"forEach\",\"found\",\"find\",\"dbUser\",\"Id\",\"username\",\"Username\",\"push\",\"PutRequest\",\"createAgentCreateParam\",\"DeleteRequest\",\"createAgentDeleteParam\",\"_validateAgentUpdate\",\"createAgentIfNeeded\",\"updateAgentById\",\"getConnectAgentByUserId\",\"createAgentPromise\",\"createAgent\",\"resolve\",\"reject\",\"undefined\",\"phone\",\"isValid\",\"getNumber\",\"Number\",\"isNaN\",\"1207\",\"_repo_voicemail_repo__WEBPACK_IMPORTED_MODULE_0__\",\"_service_voicemail_service__WEBPACK_IMPORTED_MODULE_1__\",\"_service_connect_agent_service__WEBPACK_IMPORTED_MODULE_2__\",\"_service_connect_service__WEBPACK_IMPORTED_MODULE_3__\",\"_repo_users_repo__WEBPACK_IMPORTED_MODULE_4__\",\"_service_notification_service__WEBPACK_IMPORTED_MODULE_5__\",\"_service_s3_service__WEBPACK_IMPORTED_MODULE_6__\",\"_service_transcription_service__WEBPACK_IMPORTED_MODULE_7__\",\"_service_global_settings_services__WEBPACK_IMPORTED_MODULE_8__\",\"_repo_global_repo__WEBPACK_IMPORTED_MODULE_9__\",\"globalSettingsService\",\"notificationService\",\"agentService\",\"voicemailRepo\",\"voicemailService\",\"async\",\"event\",\"context\",\"detail\",\"jobName\",\"jobStatus\",\"updateVoicemailTranscriptStatus\",\"lambdaResult\",\"err\",\"trace\",\"13\",\"connect_service_ConnectService\",\"ConnectUser\",\"userMap\",\"arn\",\"firstName\",\"lastName\",\"phoneType\",\"autoAccept\",\"deskPhoneNumber\",\"directoryUserId\",\"routingProfileId\",\"AWS\",\"instanceId\",\"split\",\"connect\",\"Connect\",\"maxBackOffTime\",\"users\",\"promises\",\"map\",\"InstanceId\",\"UserId\",\"describeUser\",\"User\",\"_listConnectUsers\",\"list\",\"nextToken\",\"retry\",\"MaxResults\",\"listUsers\",\"promise\",\"UserSummaryList\",\"NextToken\",\"concat\",\"catch\",\"warn\",\"Math\",\"min\",\"pow\",\"setTimeout\",\"14\",\"global_repo_GlobalRepo\",\"GlobalSettings\",\"globalSettingsMap\",\"AVAILABLE_SMS_COUNTRIES\",\"GLOBAL_TABLE_NAME\",\"amazonConnectInstanceArn\",\"instanceArn\",\"settings\",\"_updateGlobalSettings\",\":ac\",\"2\",\"GenericError\",\"MissingParameterError\",\"InvalidParameterError\",\"MissingParametersError\",\"Error\",\"message\",\"developerMessage\",\"parameter\",\"21\",\"ContactVoicemailRepo\",\"CONTACT_VOICEMAIL_TABLE_NAME\",\"contactId\",\"timestamp\",\"status\",\"queryParam\",\":contactId\",\"queryResult\",\"readerId\",\":status\",\"22\",\"NotificationService\",\"nodemailer__WEBPACK_IMPORTED_MODULE_0__\",\"nodemailer__WEBPACK_IMPORTED_MODULE_0___default\",\"DeliveryOptionSettings\",\"DeliveryContent\",\"transcription\",\"preSignedUrl\",\"audioFile\",\"s3Service\",\"transcriptionService\",\"ses\",\"SES\",\"sns\",\"SNS\",\"transporter\",\"createTransport\",\"recordingExpiration\",\"parseInt\",\"SIGNED_RECORDING_URL_EXP\",\"globalSettings\",\"voicemail\",\"connectAgent\",\"options\",\"getTranscribeAndEncryptionSettings\",\"deliveryOptions\",\"shouldSendEmail\",\"shouldSendSMS\",\"contactEmail\",\"agentSMSPhoneNumber\",\"getDeliveryContents\",\"contents\",\"sendTextMessage\",\"sendMail\",\"transcriptionPromise\",\"preSignedUrlPromise\",\"audioFilePromise\",\"getPreSignedUrl\",\"recordingBucketName\",\"recordingObjectKey\",\"getFile\",\"getTranscriptJobName\",\"getTranscriptForJobName\",\"fromEmailAddress\",\"toEmailAddress\",\"deliveryContent\",\"html\",\"Date\",\"contactPhoneNumber\",\"transcripts\",\"transcript\",\"floor\",\"now\",\"expires\",\"url\",\"mailOptions\",\"subject\",\"to\",\"filename\",\"content\",\"Body\",\"info\",\"deliveryPhoneNumber\",\"Message\",\"PhoneNumber\",\"publish\",\"shouldTranscribe\",\"shouldEncrypt\",\"23\",\"require\",\"24\",\"S3Service\",\"secretsManager\",\"SecretsManager\",\"getAWSCredentials\",\"getSecretValue\",\"SecretId\",\"SECRET_ARN\",\"res\",\"isTempToken\",\"secret\",\"SecretString\",\"jsonParsed\",\"accessKeyId\",\"secretAccessKey\",\"s3\",\"S3\",\"signatureVersion\",\"credentials\",\"bucket\",\"Bucket\",\"getObject\",\"Expires\",\"getSignedUrl\",\"25\",\"TranscriptionService\",\"request_promise__WEBPACK_IMPORTED_MODULE_0__\",\"request_promise__WEBPACK_IMPORTED_MODULE_0___default\",\"TranscribeService\",\"TranscriptionJobName\",\"getTranscriptionJob\",\"transcriptionJob\",\"method\",\"uri\",\"TranscriptionJob\",\"Transcript\",\"TranscriptFileUri\",\"json\",\"results\",\"26\",\"27\",\"voicemail_service_ContactVoicemailService\",\"ContactVoicemail\",\"voicemailMap\",\"transcribeStatus\",\"recordingUrl\",\"recordingBucketRegion\",\"jobNameSplit\",\"updateTranscriptionStatus\",\"eventName\",\"newRecord\",\"oldRecord\",\"newVoicemail\",\"_deliver\",\"getSettings\",\"deliver\",\"3\",\"4\",\"DynamoDBService\",\"tableName\",\"client\",\"DynamoDB\",\"DocumentClient\",\"Items\",\"allItems\",\"LastEvaluatedKey\",\"callback\",\"batch\",\"startingIndex\",\"_batchWrite\",\"index\",\"nextData\",\"endIndex\",\"batchToUpdate\",\"slice\",\"batchParam\",\"RequestItems\",\"5\",\"Agent\",\"agentMap\",\"9\"],\"mappings\":\"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\"}","code":"!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=1207)}({10:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return i}));var r=n(4),s=n(5);class i{constructor(){this.dynamo=new r.a(process.env.USERS_TABLE_NAME),this.amazonConnectInstanceId=process.env.AMAZON_CONNECT_INSTANCE_ARN}getAgentByExtension(e){let t={IndexName:\"AgentExtensionIndex\",KeyConditionExpression:\"extension = :ext\",ExpressionAttributeValues:{\":ext\":e}};return this.dynamo.query(t).then(e=>e.length>0?new s.a(e[0]):null)}getAgentByUserId(e){let t={Key:{agentId:e}};return this.dynamo.getItem(t).then(e=>e?new s.a(e):null)}getAgents(e,t){let n={Limit:t||1e3,Select:\"ALL_ATTRIBUTES\"};return e&&(n.ExclusiveStartKey=JSON.parse(Buffer.from(e,\"base64\").toString(\"utf-8\"))),this.dynamo.scanWithNext(n)}getAllAgents(){return this.dynamo.scan({Select:\"ALL_ATTRIBUTES\"})}createAgentCreateParam(e){let t={Item:{...e,agentId:e.userId}};return\"\"===e.extension&&delete t.Item.extension,t}createAgentDeleteParam(e){return{Key:{agentId:e.userId}}}createAgent(e){let t=this.createAgentData(e);return this.dynamo.put(t)}updateAgentById(e,{extension:t,deliverSMSPhoneNumber:n,deliverSMS:r,deliverEmail:s,encryptVoicemail:i,transcribeVoicemail:a}){let o={\":tv\":a||!1,\":ev\":i||!1,\":de\":s,\":do\":{email:s,sms:{enabled:r,phoneNumber:\"\"===n?\"null\":n}}};null!==t&&\"\"!==t&&(o[\":ext\"]=t);let c=\"SET transcribeVoicemail=:tv, encryptVoicemail = :ev, deliveryEmail = :de, deliveryOptions = :do\";c+=null===t||\"\"===t?\" REMOVE extension\":\", extension = :ext\";let l={Key:{agentId:e},ExpressionAttributeValues:o,UpdateExpression:c};return this.dynamo.update(l)}batchWrite(e){return this.dynamo.batchWrite(e,0)}}},11:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return r}));class r{constructor(e){this.globalRepo=e}getSettings(){return this.globalRepo.getGlobalSettings()}update(e,t,n,r){return this.globalRepo.updateGlobalSettings(e,t,n,r).then(e=>{console.log(\"Result: \"+JSON.stringify(e));let{transcribeVoicemail:t,encryptVoicemail:n,deliveryEmail:r,availableSMSCountries:s}=e.Attributes;return{transcribeVoicemail:t,encryptVoicemail:n,deliveryEmail:r,availableSMSCountries:s}})}createDefault(){return this.globalRepo.createGlobalSettings(!0,!0,process.env.DELIVERY_EMAIL)}}},12:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return l}));class r{constructor(e,t){this.userId=e.userId,this.agent=e,this.connectUser=t}}var s=n(2),i=n(5);s.a;class a extends s.a{constructor(e){super(\"ExtensionInUseError\",\"Extension already in use. Please provide a different extension number.\",\"Cannot have more than one user assigned to the extension number: \"+e)}}var o=n(9),c=n.n(o);class l{constructor(e,t){this.usersRepo=t,this.connectService=e}getConnectAgentByExtension(e){return this.usersRepo.getAgentByExtension(e).then(e=>this.connectService.getConnectUser(e.userId).then(t=>new r(e,t)))}getConnectAgentByUserId(e){return this.connectService.getConnectUser(e).then(t=>this.usersRepo.getAgentByUserId(e).then(e=>new r(e,t)))}getConnectAgents(e,t){return this.usersRepo.getAgents(e,t)}syncConnectAgents(){return Promise.all([this.connectService.listConnectUsers(),this.usersRepo.getAllAgents()]).then(e=>{let[t,n]=e,r=[];if(t.forEach(e=>{const t=n.find(t=>t.userId===e.Id);let s;t&&t.username!==e.Username?(s={...t,username:e.Username},r.push({PutRequest:this.usersRepo.createAgentCreateParam(s)})):t||(s={userId:e.Id,username:e.Username},r.push({PutRequest:this.usersRepo.createAgentCreateParam(s)}))}),n.forEach(e=>{t.find(t=>t.Id===e.userId)||r.push({DeleteRequest:this.usersRepo.createAgentDeleteParam(e)})}),r.length>0)return this.usersRepo.batchWrite(r)})}updateAgentById(e,t){return this._validateAgentUpdate(e,t).then(()=>this.createAgentIfNeeded(e,t.extension)).then(()=>this.usersRepo.updateAgentById(e,t)).then(()=>this.getConnectAgentByUserId(e))}createAgentIfNeeded(e,t){let n=this.usersRepo.getAgentByUserId(e).then(n=>null===n?this.usersRepo.createAgent(i.a.create(e,t)):n);return t?this.usersRepo.getAgentByExtension(t).then(n=>{if(null!=n&&n.userId!==e)throw new a(t);return n}).then(()=>n):n}_validateAgentUpdate(e,t){return new Promise((n,r)=>{let{extension:i,deliverSMSPhoneNumber:a,deliverSMS:o,deliverEmail:l,encryptVoicemail:u,transcribeVoicemail:d}=t;if(e)if(!0!==o||void 0!==a&&\"\"!==a){if(a){let e=new c.a(a);e.isValid()?t.deliverSMSPhoneNumber=e.getNumber():r(new s.a(\"InvalidPhoneNumberError\",\"The phone number you've entered is invalid.  Please enter a valid phone number and try again.\",\"Phone number cannot be validated for \"+a))}t.hasOwnProperty(\"extension\")&&(t.extension.length>5||Number.isNaN(t.extension))?r(new s.b(\"Invalid extension number\",\"Extension number must be numeric and less than 5 digits.\")):t.hasOwnProperty(\"extension\")&&t.hasOwnProperty(\"deliverSMS\")&&t.hasOwnProperty(\"deliverEmail\")&&t.hasOwnProperty(\"transcribeVoicemail\")&&t.hasOwnProperty(\"encryptVoicemail\")?n({agentId:e,update:t}):r(new s.d)}else r(new s.b(\"Please provide a phone number for SMS delivery\",\"deliverSMSPhoneNumber cannot be null or empty if deliverSMS is true\"));else r(new s.c(\"agentId\"))})}}},1207:function(e,t,n){\"use strict\";n.r(t);var r=n(21),s=n(27),i=n(12),a=n(13),o=n(10),c=n(22),l=n(24),u=n(25),d=n(11),h=n(14);const m=new o.a,p=new h.a,g=new d.a(p),b=new c.a(new l.a,new u.a),y=new i.a(new a.a,m),S=new r.a,v=new s.a(S,y,b,g);exports.process=async(e,t)=>{let{detail:n}=e,r=n.TranscriptionJobName,s=n.TranscriptionJobStatus;try{await v.updateVoicemailTranscriptStatus(r,s);return{lambdaResult:\"Success\"}}catch(e){console.trace(),console.log(\"Error Processing Transcript. Error: \",JSON.stringify(e,null,2))}}},13:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return i}));class r{constructor(e,t=!0){this.userId=e.Id,this.arn=e.Arn,this.username=e.Username,t&&(this.firstName=e.IdentityInfo.FirstName,this.lastName=e.IdentityInfo.LastName,this.email=e.IdentityInfo.Email,e.hasOwnProperty(\"PhoneConfig\")?(this.phoneType=e.PhoneConfig.PhoneType,this.autoAccept=e.PhoneConfig.AutoAccept,this.deskPhoneNumber=e.PhoneConfig.DeskPhoneNumber):(this.phoneType=null,this.autoAccept=null,this.deskPhoneNumber=null),this.directoryUserId=e.DirectoryUserId,this.routingProfileId=e.RoutingProfileId)}getFullName(){return`${this.firstName} ${this.lastName}`}}const s=n(3);class i{constructor(){this.instanceId=process.env.AMAZON_CONNECT_INSTANCE_ARN.split(\"/\")[1],this.connect=new s.Connect,this.maxBackOffTime=45}getConnectUsers(){return this.listConnectUsers().then(e=>{let t=e.map(e=>this.getConnectUser(e.Id));return Promise.all(t)})}getConnectUser(e){return new Promise((t,n)=>{let s={InstanceId:this.instanceId,UserId:e};this.connect.describeUser(s,(e,s)=>e?(console.log(\"Error\",e),void n(e)):s?void t(new r(s.User)):(console.log(\"No user found\"),void n(e)))})}listConnectUsers(){return this._listConnectUsers([],null,0)}_listConnectUsers(e,t,n){let r={InstanceId:this.instanceId,MaxResults:1e3};return t&&(r.NextToken=t),this.connect.listUsers(r).promise().then(t=>{let{UserSummaryList:n,NextToken:r}=t,s=e.concat(n);return r?this._listConnectUsers(s,r,0):s}).catch(r=>{if(console.warn(\"list connect user failed. Retry: \"+n,r),n>5)throw r;return(s=Math.min(Math.pow(n,2),this.maxBackOffTime),new Promise(e=>setTimeout(e,s))).then(()=>this._listConnectUsers(e,t,n+1));var s})}}},14:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return i}));var r=n(4);class s{constructor(e){this.transcribeVoicemail=e.transcribeVoicemail||!1,this.encryptVoicemail=e.encryptVoicemail||!1,this.deliveryEmail=e.deliveryEmail||null,this.availableSMSCountries=e.availableSMSCountries||(process.env.AVAILABLE_SMS_COUNTRIES||\"\").split(\",\")}}class i{constructor(){this.dynamo=new r.a(process.env.GLOBAL_TABLE_NAME),this.amazonConnectInstanceArn=process.env.AMAZON_CONNECT_INSTANCE_ARN}getGlobalSettings(){console.log(\"Getting Global Settings\");let e={Key:{instanceArn:this.amazonConnectInstanceArn}};return this.dynamo.getItem(e).then(e=>e?new s(e):null)}createGlobalSettings(e,t,n,r){let i=new s({transcribeVoicemail:e,encryptVoicemail:t,deliveryEmail:n,availableSMSCountries:r});i.instanceArn=this.amazonConnectInstanceArn;let a={Item:i};return console.log(\"dynamo put\"),this.dynamo.put(a).then(()=>i)}updateGlobalSettings(e,t,n,r){return this.getGlobalSettings().then(s=>s?this._updateGlobalSettings(e,t,n,r):(console.log(\"in create\"),this.createGlobalSettings(e,t,n,r)))}_updateGlobalSettings(e,t,n,r){let s={Key:{instanceArn:this.amazonConnectInstanceArn},ExpressionAttributeValues:{\":tv\":e,\":ev\":t,\":de\":n,\":ac\":r},UpdateExpression:\"SET transcribeVoicemail=:tv, encryptVoicemail=:ev, deliveryEmail=:de, availableSMSCountries=:ac\"};return this.dynamo.update(s)}}},2:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return r})),n.d(t,\"c\",(function(){return s})),n.d(t,\"b\",(function(){return i})),n.d(t,\"d\",(function(){return a}));class r extends Error{constructor(e,t,n){super(),this.message=t,this.developerMessage=n,this.name=e}}class s extends r{constructor(e){super(\"MissingParameterError\",\"Missing parameter\",\"Missing parameter: \"+e)}}class i extends r{constructor(e,t){super(\"InvalidParameterValueError\",e,t)}}class a extends r{constructor(){super(\"MissingParametersError\",\"One or more parameters are missing\",\"You have one ore more parameters miss, please see documentation for more information.\")}}},21:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return s}));var r=n(4);class s{constructor(){this.dynamo=new r.a(process.env.CONTACT_VOICEMAIL_TABLE_NAME)}updateTranscriptionStatus(e,t,n){let r={KeyConditionExpression:\"contactId = :contactId\",ExpressionAttributeValues:{\":contactId\":e}};return Promise.all([this.dynamo.query(r)]).then(t=>{let r=[];return t[0].map(t=>{let s={Key:{contactId:e,readerId:t.readerId},ExpressionAttributeValues:{\":status\":n},UpdateExpression:\"SET transcribeStatus = :status\"};r.push(this.dynamo.update(s))}),Promise.all(r)})}}},22:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return c}));var r=n(23),s=n.n(r);const i=n(3);class a{constructor(e,t){this.transcribe=e,this.encrypt=t}}class o{constructor(e,t,n){this.transcription=e,this.preSignedUrl=t,this.audioFile=n}}class c{constructor(e,t){this.s3Service=e,this.transcriptionService=t,this.ses=new i.SES,this.sns=new i.SNS,this.transporter=s.a.createTransport({SES:this.ses}),this.recordingExpiration=parseInt(process.env.SIGNED_RECORDING_URL_EXP)}deliver(e,t,n){let r=this.getTranscribeAndEncryptionSettings(e,t),s=n.agent.deliveryOptions,i=s.email,a=s.sms.enabled,o=n.connectUser.email||n.connectUser.username,c=s.sms.phoneNumber,l=e.deliveryEmail;if(!l)throw\"You must provide a delivery email\";return i||a?i&&a?(console.log(\"Should Send BOTH email and SMS\"),this.getDeliveryContents(r,t).then(e=>this.sendTextMessage(t,c,e).then(()=>this.sendMail(t,l,o,e)))):a&&c?(console.log(\"Send ONLY SMS\"),this.getDeliveryContents(r,t).then(e=>this.sendTextMessage(t,c,e))):s.email?(console.log(\"Send ONLY Email\"),this.getDeliveryContents(r,t).then(e=>this.sendMail(t,l,o,e))):Promise.resolve({message:\"Undeliverable\"}):(console.log(\"NOT sending email or sms\"),Promise.resolve({message:\"Not sending Email or SNS\"}))}getDeliveryContents(e,t){console.log(\"Getting Delivery Contents\");let n=Promise.resolve(null),r=Promise.resolve(null),s=Promise.resolve(null);if(e.encrypt?(console.log(\"Encrypt...\"),r=this.s3Service.getPreSignedUrl(t.recordingBucketName,t.recordingObjectKey,this.recordingExpiration)):(console.log(\"Unencrypted...\"),s=this.s3Service.getFile(t.recordingBucketName,t.recordingObjectKey)),e.transcribe){console.log(\"Transcribe...\");let e=t.getTranscriptJobName();n=this.transcriptionService.getTranscriptForJobName(e)}return Promise.all([n,r,s]).then(e=>{let t=e[0],n=e[1],r=e[2];return new o(t,n,r)})}sendMail(e,t,n,r){return new Promise((s,i)=>{let a=`<p>${new Date(1e3*e.timestamp)}</p>`;if(a+=`<p>New voicemail from ${e.contactPhoneNumber}.</p>`,r.transcription&&(a+=`<b>Voicemail Transcript:</b><p>${r.transcription.transcripts[0].transcript}</p>`),a+=\"<b>Voicemail:</b>\",r.preSignedUrl){a+=`<p>Voicemail Expiration Date: ${new Date(1e3*Math.floor(Date.now()/1e3+r.preSignedUrl.expires))}</p>`,a+=`<p><a href=\"${r.preSignedUrl.url}\">Click Here</a> to listen to the voicemail</p>`}let o={from:t,subject:\"New voicemail from \"+e.contactPhoneNumber,html:a,to:n};r.audioFile&&(o.attachments=[{filename:\"voicemail.wav\",content:r.audioFile.Body}]),this.transporter.sendMail(o,(e,t)=>{if(e)return console.log(e),void i(e);s(t)})})}sendTextMessage(e,t,n){return new Promise((r,s)=>{let i=`Amazon Connect voicemail from ${e.contactPhoneNumber}\\n`;if(n.transcription&&(i+=`\\nTranscript: \"${n.transcription.transcripts[0].transcript}\"\\n`),n.preSignedUrl){i+=`\\nVoicemail Expiration Date: ${new Date(1e3*Math.floor(Date.now()/1e3+n.preSignedUrl.expires))}\\n`,i+=\"\"+n.preSignedUrl.url}let a={Message:i,PhoneNumber:t};this.sns.publish(a,(e,t)=>{e&&console.log(\"Error: \"+e),r(t)})})}getTranscribeAndEncryptionSettings(e,t){let n=!1,r=!0;return!0===e.transcribeVoicemail&&(n=t.shouldTranscribe),!1===e.encryptVoicemail&&(r=t.shouldEncrypt),new a(n,r)}}},23:function(e,t){e.exports=require(\"nodemailer\")},24:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return s}));const r=n(3);class s{constructor(){this.secretsManager=new r.SecretsManager;const e=async()=>await this.secretsManager.getSecretValue({SecretId:process.env.SECRET_ARN}).promise().then(e=>e).catch(e=>(console.log(\"error \",e),e));(async()=>{const t=await e();if(this.isTempToken=!1,\"SecretString\"in t){var n=t.SecretString,s=JSON.parse(n),i=s.accessKeyId,a=s.secretAccessKey;this.s3=new r.S3({signatureVersion:\"v4\",credentials:{secretAccessKey:a,accessKeyId:i}})}else this.isTempToken=!0,this.s3=new r.S3})()}getFile(e,t){let n={Bucket:e,Key:t};return this.s3.getObject(n).promise()}getPreSignedUrl(e,t,n=900){return new Promise((r,s)=>{this.isTempToken?n>43200&&(console.log(\"Could not create a presigned URL valid for greater than 12 hours because there was an error while retrieving the IAM User Access Key credentials from the AWS Secrets Manager (please refer to CloudWatch Logs for details). So creating a presigned URL valid up to 12 hours using temporary credentials of Lambda IAM Role.\"),n=43200):console.log(\"Creating a pre-signed URL valid up to \"+n+\" seconds using IAM User Access Key.\");let i={Bucket:e,Key:t,Expires:n};return this.s3.getSignedUrl(\"getObject\",i,(e,t)=>{e?s(e):r({url:t,expires:n})})})}}},25:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return a}));var r=n(26),s=n.n(r);const i=n(3);class a{constructor(){this.transcribe=new i.TranscribeService}getTranscriptForJobName(e){let t={TranscriptionJobName:e};return this.transcribe.getTranscriptionJob(t).promise().then(e=>{let t={method:\"GET\",uri:e.TranscriptionJob.Transcript.TranscriptFileUri,json:!0};return s()(t).then(t=>({transcriptionJob:e,transcripts:t.results.transcripts||null}))}).catch(e=>{console.log(e)})}}},26:function(e,t){e.exports=require(\"request-promise\")},27:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return s}));class r{constructor(e){this.contactId=e.contactId,this.timestamp=e.timestamp,this.agentId=e.readerId,this.contactPhoneNumber=e.contactPhoneNumber,this.shouldTranscribe=e.shouldTranscribe||!1,this.shouldEncrypt=e.shouldEncrypt||!1,this.transcribeStatus=e.transcribeStatus,this.recordingUrl=e.recordingUrl,this.recordingBucketName=e.recordingBucketName,this.recordingObjectKey=e.recordingObjectKey,this.recordingBucketRegion=e.recordingBucketRegion}getTranscriptJobName(){return`${this.contactId}_${this.timestamp}`}}class s{constructor(e,t,n,r){this.voicemailRepo=e,this.agentService=t,this.notificationService=n,this.globalSettingsService=r}updateVoicemailTranscriptStatus(e,t){let n=e.split(\"_\"),r=n[0],s=parseInt(n[1]);return this.voicemailRepo.updateTranscriptionStatus(r,s,t)}processVoicemailRecords(e,t,n){console.log(\"Processing Voicemail Recording\");let s=new r(t);return\"IN_PROGRESS\"===new r(n).transcribeStatus&&\"COMPLETED\"===s.transcribeStatus||null===s.transcribeStatus||void 0===s.transcribeStatus?this._deliver(s):Promise.resolve({message:\"Unhandled Resolution\"})}_deliver(e){return Promise.all([this.globalSettingsService.getSettings(),this.agentService.getConnectAgentByUserId(e.agentId)]).then(t=>{let n=t[0],r=t[1];return this.notificationService.deliver(n,e,r)})}}},3:function(e,t){e.exports=require(\"aws-sdk\")},4:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return s}));const r=n(3);class s{constructor(e){this.tableName=e,this.client=new r.DynamoDB.DocumentClient}update(e){return e.TableName=this.tableName,e.ReturnValues=\"ALL_NEW\",this.client.update(e).promise()}put(e){return e.TableName=this.tableName,this.client.put(e).promise()}query(e){return e.TableName=this.tableName,this.client.query(e).promise().then(e=>e.Items||null)}scan(e,t=[]){return e.TableName=this.tableName,this.client.scan(e).promise().then(n=>{let r=t;return n.Items&&(r=t.concat(n.Items)),n.LastEvaluatedKey?(console.log(\"Rescanning with next page\"),e.ExclusiveStartKey=n.LastEvaluatedKey,this.scan(e,r)):r})}queryWithNext(e){return e.TableName=this.tableName,this.client.query(e).promise().then(e=>{let t={data:e.Items||[]};return e.LastEvaluatedKey&&(t.next=Buffer.from(JSON.stringify(e.LastEvaluatedKey),\"utf8\").toString(\"base64\")),t})}scanWithNext(e){return e.TableName=this.tableName,this.client.scan(e).promise().then(e=>{let t={data:e.Items||[]};return e.LastEvaluatedKey&&(t.next=Buffer.from(JSON.stringify(e.LastEvaluatedKey),\"utf8\").toString(\"base64\")),t})}getItem(e,t){return e.TableName=this.tableName,this.client.get(e).promise().then(e=>e.Item||null)}batchWrite(e,t){return new Promise((n,r)=>{this._batchWrite(e,t).then(t=>{e.length>t.index?this.batchWrite(e,t.index).then(e=>{n(e)}):n(t.data)})})}_batchWrite(e,t){return new Promise((n,r)=>{let s=e.length>t+24?t+24:e.length,i=e.slice(t,s),a={RequestItems:{[this.tableName]:i}};this.client.batchWrite(a,(e,r)=>{e&&console.log(\"Any error? \"+JSON.stringify(e,null,2)),n({index:t+24,data:r})})})}}},5:function(e,t,n){\"use strict\";n.d(t,\"a\",(function(){return r}));class r{constructor(e){this.userId=e.userId,this.extension=e.extension,this.username=e.username,this.transcribeVoicemail=e.transcribeVoicemail||!1,this.encryptVoicemail=e.encryptVoicemail||!1,this.deliveryOptions=e.deliveryOptions||{sms:{enabled:!1,phoneNumber:null},email:!1}}static create(e,t=null){return new r({userId:e,extension:t,deliveryOptions:{sms:{enabled:!1,phoneNumber:null},email:!1}})}}},9:function(e,t){e.exports=require(\"awesome-phonenumber\")}}));","extractedComments":[]}